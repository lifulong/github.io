<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Bash语法 | Moses </title> <meta name="description" content=" Fucking Big Data "> <meta name="keywords" content="Hadoop, Spark, Storm, Kafka, Akaka, BigData"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Moses"> <meta property="article:section" content="bash"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2014-11-28 00:00:00 +0800"> <meta property="og:url" content="http://lifulong.me/2014/bash/"> <meta property="og:title" content=" Bash语法 | Moses "> <meta property="og:image" content="http://lifulong.me"> <meta property="og:description" content=" Fucking Big Data "> <meta property="og:site_name" content="Moses"> <meta property="og:locale" content="pt_BR"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@leefulong"> <meta name="twitter:title" content=" Bash语法 | Moses "> <meta name="twitter:description" content=" Fucking Big Data "> <meta name="twitter:image:src" content="http://lifulong.me"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Bash语法 | Moses "> <meta itemprop="description" content=" Fucking Big Data "> <meta itemprop="image" content="http://lifulong.me"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://lifulong.me/2014/bash/"> <link rel="alternate" type="application/rss+xml" title="Moses" href="http://lifulong.me/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'lifulong'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-52446115-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Moses<span>blog</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/feed.xml" target="_blank">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Bash语法</h1> <p class="post-meta"><time datetime="2014-11-28T00:00:00+08:00" itemprop="datePublished">Nov 28, 2014</time></p> </header> <div class="post-content" itemprop="articleBody"> <h3 id="bash">BASH语法</h3> <h4 id="section">表达式求值</h4> <ul> <li>eval 对表达式的值计算两次，并返回</li> <li>` 计算表达式的值</li> <li>示例</li> </ul> <blockquote><pre><code>eval $()
</code></pre></blockquote> <ul> <li>数学表达式计算</li> </ul> <blockquote><pre><code>num=$[num+1]
num=$((num+1))
num=`expr $num+1`
</code></pre></blockquote> <h4 id="section-1">() 与 {}</h4> <ul> <li>()用户组合执行多个命令；</li> <li>{}用户组合执行多个命令；</li> <li>()多个命令在子Shell中执行；{}在当前Shell中执行；</li> </ul> <h4 id="section-2">(()) 与 $(())</h4> <ul> <li>(())专用于数值计算；</li> <li>$(())直接获取数值计算结果；</li> </ul> <h4 id="section-3">’ 与 “</h4> <ul> <li>‘号内所有字符当作普通字符处理</li> <li>“号内’$’与’`‘当作特殊字符处理</li> </ul> <h4 id="section-4">文件重定向</h4> <ul> <li><strong>exec</strong></li> </ul> <blockquote><pre><code>exec 3&lt;&gt;$filename
</code></pre></blockquote> <ul> <li>关闭3的输出</li> </ul> <blockquote><pre><code>exec 3&lt;&amp;-
</code></pre></blockquote> <ul> <li>关闭3的输入</li> </ul> <blockquote><pre><code>exec 3&gt;&amp;-
</code></pre></blockquote> <h4 id="section-5">数组</h4> <ul> <li>声明数组</li> </ul> <blockquote><pre><code>declare -a array_name
</code></pre></blockquote> <ul> <li>声明关联数组</li> </ul> <blockquote><pre><code>declare -A array_name
</code></pre></blockquote> <ul> <li>创建数组</li> </ul> <blockquote><pre><code>array_name=(\'ele1\', \'ele2\')
array_name=([0]=\'ele1\', [1]=\'ele2\')
array_name[0]=\'ele1\'		array_name[1] = \'ele2\'
str="1 2 3 4 5"		arr=($str)
read -a array_name &lt;&lt;&lt; "str str2 str3"
IFS=: read -a array_name &lt;&lt;&lt; "str:str2:str3"
</code></pre></blockquote> <ul> <li>数组操作</li> </ul> <blockquote><pre><code>${#array_name[*]}
${#array_name[@]}
${array_name[*]}
${array_name[@]}
${array_name[n]}
</code></pre></blockquote> <ul> <li>销毁数组</li> </ul> <blockquote><pre><code>unset arr[1]	#销毁某个元素
unset arr		#销毁整个数组
unset arr[*]		#销毁整个数组
unset arr[@]		#销毁整个数组
</code></pre></blockquote> <ul> <li>关联数组</li> </ul> <blockquote><pre><code>array_name=([key1]="value1", [key2]="value2")  
</code></pre></blockquote> <blockquote><pre><code>for key in ${!array_name[*]}
do
	echo $key,${array_name[$key]}
done
</code></pre></blockquote> <blockquote><pre><code>for value in ${array_name[*]}
do
	echo $value
done
</code></pre></blockquote> <ul> <li>数组名本身是变量(变量数组名)</li> </ul> <blockquote><pre><code>read driver_id yearmonth&lt;&lt;-EOF
	$line
EOF
arrname=driver_online_arr_${yearmonth}
eval $arrname[$driver_id]=1
eval echo \${$arrname[$driver_id]}
value=$(eval echo \${$arrname[$driver_id]})
</code></pre></blockquote> <h4 id="section-6">字符串处理</h4> <ul> <li>取字符串长度</li> </ul> <blockquote><pre><code>expr length $str
expr ${#str}
expr "$str" : ".*"
</code></pre></blockquote> <ul> <li>查找字串位置</li> </ul> <blockquote><pre><code>expr index $str "substr"
</code></pre></blockquote> <ul> <li>字符串替换</li> </ul> <blockquote><pre><code>str="apple, tree, apple tree"
echo ${str/apple/APPLE}   # 替换第一次出现的apple
echo ${str//apple/APPLE}  # 替换所有apple
echo ${str/#apple/APPLE}  # 如果字符串str以apple开头，则用APPLE替换它
echo ${str/%apple/APPLE}  # 如果字符串str以apple结尾，则用APPLE替换它
</code></pre></blockquote> <ul> <li>选取字串</li> </ul> <blockquote><pre><code>expr substr "$str" start_pos end_pos
echo ${str:start_pos}
echo ${str:start_pos:end_pos}
echo ${str:-start_pos:end_pos}
</code></pre></blockquote> <ul> <li>截_去_字串</li> </ul> <blockquote><pre><code>echo ${str#a*c}		#左边截取最短的匹配
echo ${str##a*c}	#左边截取最长的匹配
echo ${str#"a*c"}	#左边截取最短的匹配
echo ${str##"a*c"}	#左边截取最长的匹配
echo ${str%a*c}		#右边截取最短的匹配
echo ${str%%a*c}	#右边截取最长的匹配
</code></pre></blockquote> <ul> <li>比较</li> </ul> <blockquote><pre><code>[[ "a.txt" == a.* ]]		#pattern compare
[[ "a.txt" = ~ .*\.txt ]]	#regex compare
[[ "str1" == "str2" ]]
[[ "str1" &lt; "str2" ]]
</code></pre></blockquote> <ul> <li>连接</li> </ul> <blockquote><pre><code>${str1}${str2}
</code></pre></blockquote> <h3 id="bash-1">BASH调试</h3> <ul> <li>-x 将每条执行的命令输出到标准输出</li> </ul> <blockquote><pre><code>set -x
/bin/bash -x
bash -x bashfilr.sh
</code></pre></blockquote> <ul> <li>-n 直输出命令，不执行</li> <li>-v 将读取到的shell脚本输出到标准输出</li> <li>trap</li> </ul> <blockquote><pre><code>trap 'err_func param' ERR|EXIT|DEBUG
</code></pre></blockquote> <ul> <li>定义 DEBUG 调试钩子</li> </ul> <blockquote><pre><code>DEBUG="true"
function DEBUG()
{
	if [ "$DEBUG" = "" ]; then
		$@
	fi
}
</code></pre></blockquote> <h3 id="bash-2">BASH作业管理</h3> <ul> <li>jobs:查看当前在后台执行的进程</li> <li>Ctrl+z:建当前的前台进程暂停，变成后台进程</li> <li>bg:将后台暂停的程序继续执行</li> <li>fg:将后台进程调到前台继续执行</li> </ul> <blockquote><pre><code>fg jobs_num
</code></pre></blockquote> <ul> <li>():新建子Shell执行命令，相当于子进程</li> </ul> <blockquote><pre><code>(cmd)
</code></pre></blockquote> <h3 id="section-7">其他</h3> <ul> <li>read命令</li> </ul> <blockquote><pre><code>PATH=$PWD
read -a -r arr &lt;&lt;&lt; $PATH		#-r读取原始内容
</code></pre></blockquote> <ul> <li> <p>cut命令</p> </li> <li> <p>以TAB分隔，打印第N个子串值，N从1开始计数。</p> </li> </ul> <blockquote><pre><code>echo "$STR" | cut -f $N
</code></pre></blockquote> <ul> <li>以指定DELIM分隔，打印第N个子串值，N从1开始计数。</li> <li>其中，-d部分也可以是$N1,$N2,$N3的形式，即输出多个子串。</li> </ul> <blockquote><pre><code>echo "$STR" | cut -d "$DELIM" -d $N
</code></pre></blockquote> <ul> <li> <p>bc命令</p> </li> <li> <p>declare命令</p> </li> </ul> <blockquote><pre><code>declare -a var		#声明为数组
declare -p var		#显示该变量
declare -i var		#声明为整数
declare -x var		#声明为环境变量
declare -f		#显示所有自定义函数名称和函数体
declare -F		#显示所有自定义函数
declare -f var		#声明为函数
</code></pre></blockquote> <ul> <li>stat命令</li> </ul> <blockquote><pre><code>stat -c %y filename
</code></pre></blockquote> <ul> <li>Bash Shell中变量是没有作用域的，默认是全局变量, local 声明局部变量</li> </ul> <blockquote><pre><code>local variable
</code></pre></blockquote> <h3 id="bash-3">BASH命令行命令</h3> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=Bash语法&amp;url=http://lifulong.me/2014/bash/&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://lifulong.me/2014/bash/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> <small class="pull-right">by <a href="http://lifulong.github.io/" target="_blank">lifulong.me</a></small> </div> </footer> </main> </body> </html>
